# ğŸ“ MCP-CLI å®æˆ˜æ•™ç¨‹ï¼šä»é›¶å¼€å‘åˆ°æœåŠ¡ä¸Šçº¿

æœ¬æ•™ç¨‹å°†å¸¦ä½ ä»é›¶å¼€å§‹ï¼ŒåŸºäº mcpy-cli å¿«é€Ÿå¼€å‘ã€è¿è¡Œã€æ‰“åŒ…å¹¶è°ƒç”¨ä¸€ä¸ªè‡ªå®šä¹‰ MCP æœåŠ¡ã€‚æ‰€æœ‰æ­¥éª¤å‡ç»“åˆå®é™…ä»£ç ä¸å‘½ä»¤è¡Œæ“ä½œï¼Œé€‚åˆæ–°æ‰‹å’Œè¿›é˜¶ç”¨æˆ·ã€‚

---

## 1. ç¼–å†™ä½ çš„å·¥å…·å‡½æ•°

ä»¥æœ€ç®€å•çš„åŠ æ³•å·¥å…·ä¸ºä¾‹ï¼Œæ–°å»º `my_tools.py`ï¼š

```python
from typing import Dict

def add(a: float, b: float) -> Dict[str, float]:
    """åŠ æ³•å·¥å…·ï¼šè¿”å› a + b çš„ç»“æœ"""
    return {"result": a + b}
```

ä½ å¯ä»¥åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­å®šä¹‰å¤šä¸ªå‡½æ•°ï¼Œæ¯ä¸ªå‡½æ•°éƒ½å¯ä»¥è¢«æš´éœ²ä¸º MCP å·¥å…·ã€‚

---

## 2. ç”¨ mcpy-cli å¯åŠ¨æœ¬åœ°æœåŠ¡

åœ¨å‘½ä»¤è¡Œä¸­è¿è¡Œï¼ˆå‡è®¾ä½ å·²å®‰è£… mcpy-cliï¼‰ï¼š

```powershell
# æ¨èï¼šä½¿ç”¨é»˜è®¤çš„ Streamable HTTP ä¼ è¾“åè®®
mcpy-cli run --source-path my_tools.py --host 127.0.0.1 --port 8080
```

- é»˜è®¤ä¼šè‡ªåŠ¨å‘ç°æ‰€æœ‰å¸¦ç±»å‹æ³¨è§£çš„å‡½æ•°å¹¶æš´éœ²ä¸ºå·¥å…·ã€‚
- è®¿é—® http://127.0.0.1:8080/mcp/docs å¯æŸ¥çœ‹è‡ªåŠ¨ç”Ÿæˆçš„ OpenAPI æ–‡æ¡£ã€‚
- é»˜è®¤ä½¿ç”¨ Streamable HTTP ä¼ è¾“åè®®ï¼Œå…·æœ‰æ›´å¥½çš„äº‘ç¯å¢ƒå…¼å®¹æ€§ã€‚

> **æ³¨æ„**: å¦‚æœä½ éœ€è¦å‘åå…¼å®¹æ—§ç³»ç»Ÿï¼Œå¯ä»¥ä½¿ç”¨ `--legacy-sse` å‚æ•°ï¼Œä½†è¿™æ˜¯å·²å¼ƒç”¨çš„æ¨¡å¼ï¼Œåœ¨äº‘ç¯å¢ƒä¸­å­˜åœ¨å·²çŸ¥é—®é¢˜ï¼š
> ```powershell
> # ä»…ç”¨äºå‘åå…¼å®¹ï¼ˆä¸æ¨èï¼‰
> mcpy-cli run --source-path my_tools.py --host 127.0.0.1 --port 8080 --legacy-sse
> ```

---

## 3. æ‰“åŒ…ä½ çš„æœåŠ¡

å°†å·¥å…·æ‰“åŒ…ä¸ºå¯åˆ†å‘çš„ MCP æœåŠ¡åŒ…ï¼š

```powershell
mcpy-cli package --source-path my_tools.py --package-name my_mcp_service
```

- ä¼šç”ŸæˆåŒ…å« `start.sh`ã€READMEã€ä¾èµ–ç­‰çš„å®Œæ•´åŒ…ï¼Œå¯ç›´æ¥éƒ¨ç½²ã€‚

---

## 4. å®¢æˆ·ç«¯è°ƒç”¨ç¤ºä¾‹

ä½ å¯ä»¥ç”¨ Python å®¢æˆ·ç«¯è°ƒç”¨æœåŠ¡ï¼ˆå‚è€ƒ `src/mcp-tutorial/examples/client.py`ï¼‰ï¼š

```python
import asyncio
from fastmcp import Client

async def main():
    async with Client("http://127.0.0.1:8080/mcp") as client:
        result = await client.call_tool("add", {"a": 1, "b": 2})
        print(result)

asyncio.run(main())
```

---

## 5. è¿›é˜¶ç”¨æ³•

### å¤šæ–‡ä»¶/å¤šæ¨¡å—ç»„åˆ
- æ”¯æŒä¼ å…¥ç›®å½•ï¼Œè‡ªåŠ¨å‘ç°æ‰€æœ‰ Python æ–‡ä»¶å¹¶æŒ‚è½½ä¸ºå¤šè·¯ç”±æœåŠ¡ã€‚
- æ”¯æŒ Composedï¼ˆå•å…¥å£ï¼‰ä¸ Routedï¼ˆå¤šå…¥å£ï¼‰ä¸¤ç§æ¨¡å¼ï¼Œè¯¦è§ `docs/architecture-modes.md`ã€‚

### ç¼“å­˜ä¸ä¼šè¯
- MCP-CLI å†…ç½®ä¼šè¯çº§ç¼“å­˜ï¼ˆ`SessionToolCallCache`ï¼‰ï¼Œæå‡é‡å¤è°ƒç”¨æ•ˆç‡ã€‚

### å¸¸è§é—®é¢˜
- å·¥å…·æœªè¢«å‘ç°ï¼Ÿè¯·ç¡®ä¿å‡½æ•°æœ‰ç±»å‹æ³¨è§£å’Œ docstringã€‚
- ç«¯å£å†²çªï¼Ÿæ›´æ¢ `--port` å‚æ•°ã€‚
- è¯¦ç»†æ—¥å¿—ï¼šåŠ  `--log-level DEBUG`ã€‚

---

## 6. å‚è€ƒä¸æ›´å¤š
- è¿›é˜¶ç¤ºä¾‹è§ `src/mcp-tutorial/examples/servers/` ç›®å½•ã€‚
- è¯¦ç»†å‚æ•°ä¸é«˜çº§é…ç½®è§ `docs/README.md`ã€‚
- é‡åˆ°é—®é¢˜å¯æŸ¥é˜… `docs/qa.md`ã€‚

---
